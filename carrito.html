<!DOCTYPE html>
<html lang="es">

<link rel="stylesheet" href="./assets/css/styles.css">
<link rel="stylesheet" href="./assets/css/theme.css">

    <head>
    <meta charset="UTF-8">
    <title>Carrito | ShopUniverses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>

    <!-- NAVEGACIÃ“N -->
    <nav>
    <a href="./index.html">Inicio</a> |
    <a href="./catalogo.html">CatÃ¡logo</a> |
    <a href="./spin.html">Spin</a>
    </nav>

    <h1>ðŸ›’ Carrito de Compras</h1>

    <p>
    Revisa tu pedido antes de enviarlo por WhatsApp.
    </p>

    <hr>

    <!-- LISTADO DEL CARRITO -->
    <h3>Productos en el carrito</h3>
    <ul id="lista-carrito"></ul>

    <p>
    <strong>Total:</strong> $
    <span id="total">0</span>
    </p>

    <hr>

    <!-- ACCIONES -->
    <button onclick="enviarPedidoWA()">Enviar pedido por WhatsApp</button>
    <button onclick="cancelarCompra()">Cancelar compra</button>

    <!-- LOG -->
    <hr>
    <h3>Log</h3>
    <div id="log"></div>

    <!-- SCRIPTS -->
    <script src="./assets/js/data.js"></script>
    <script src="./assets/js/spin.js"></script>
    <script src="./assets/js/carrito.js"></script>
    <script src="./assets/js/main.js"></script>

    <script>
    /**************************************************
    * UTILIDADES
    **************************************************/

    function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
    }

    /**************************************************
    * RENDER
    **************************************************/

    function renderCarrito() {
    const ul = document.getElementById("lista-carrito");
    const items = getItemsCarrito();

    ul.innerHTML = "";

    if (items.length === 0) {
        ul.innerHTML = "<li>El carrito estÃ¡ vacÃ­o.</li>";
    } else {
        items.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = `${item.nombre} â€” $${item.precio}`;

        // Permitir eliminar SOLO productos de catÃ¡logo
        if (item.tipo === "producto" && item.origen === "catalogo") {
            const btn = document.createElement("button");
            btn.textContent = "Quitar";
            btn.style.marginLeft = "10px";

            btn.onclick = () => {
            eliminarProducto(index, item.id);
            };

            li.appendChild(btn);
        }

        ul.appendChild(li);
        });
    }

    document.getElementById("total").innerText = getTotal();
    }

    /**************************************************
    * ACCIONES
    **************************************************/

    function eliminarProducto(index, productoId) {
    eliminarItem(index);
    restaurarStock([productoId]);
    log("Producto eliminado del carrito");
    renderCarrito();
    }

    function cancelarCompra() {
    cancelarCompraCompleta();
    log("âŒ Compra cancelada y stock restaurado");
    renderCarrito();
    }

    function enviarPedidoWA() {
    const items = getItemsCarrito();

    if (items.length === 0) {
        alert("El carrito estÃ¡ vacÃ­o");
        return;
    }

    enviarPedido("573207096148"); // â† tu nÃºmero
    }

    /**************************************************
    * INIT
    **************************************************/

    document.addEventListener("DOMContentLoaded", async () => {
    await cargarInventario();
    inicializarCarrito();
    renderCarrito();
    });
    </script>

    </body>
</html>
