<!DOCTYPE html>
<html lang="es">

<link rel="stylesheet" href="./assets/css/styles.css">
<link rel="stylesheet" href="./assets/css/theme.css">

    <head>
    <meta charset="UTF-8">
    <title>Carrito | ShopUniverses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>

    <!-- NAVEGACIÃ“N -->
    <nav>
        <a href="./index.html">Inicio</a>
        <a href="./catalogo.html">CatÃ¡logo</a>
        <a href="./spin.html">Spin</a>
        <a href="./carrito.html">Carrito</a>
    </nav>

    <main class="container">
        <header class="section">
            <h1>ðŸ›’ Tu Carrito</h1>
            <p style="color: var(--color-text-muted);">Revisa tu pedido estelar antes de enviarlo por WhatsApp.</p>
        </header>

        <div class="grid" style="grid-template-columns: 1fr 350px; align-items: start;">
            
            <section class="card">
                <h3>Productos en el pedido</h3>
                <hr style="border: 0; border-top: 1px solid var(--color-border); margin: 20px 0;">
                <ul id="lista-carrito">
                    </ul>
            </section>

            <aside class="card" style="position: sticky; top: 20px;">
                <h3>Resumen</h3>
                <div class="flex-between" style="margin: 20px 0; font-size: 1.2rem;">
                    <span>Total:</span>
                    <strong style="color: var(--color-accent);">$<span id="total">0</span></strong>
                </div>
                
                <div class="producto-accion">
                    <button onclick="enviarPedidoWA()">ðŸš€ Enviar por WhatsApp</button>
                    <button class="secondary" onclick="cancelarCompra()">Vaciar Carrito</button>
                </div>

                <div id="log" style="margin-top: 20px; font-size: 0.8rem; color: var(--color-text-muted);"></div>
            </aside>
        </div>
    </main>

    <!-- SCRIPTS -->
    <script src="./assets/js/data.js"></script>
    <script src="./assets/js/spin.js"></script>
    <script src="./assets/js/carrito.js"></script>
    <script src="./assets/js/main.js"></script>

    <script>
    /**************************************************
    * UTILIDADES
    **************************************************/

    function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
    }

    /**************************************************
    * RENDER
    **************************************************/

    function renderCarrito() {
    const ul = document.getElementById("lista-carrito");
    const items = getItemsCarrito();

    ul.innerHTML = "";

    if (items.length === 0) {
        ul.innerHTML = `<li style="text-align:center; padding: 40px; color:var(--color-text-muted);">
                            El carrito estÃ¡ orbitando vacÃ­o... ðŸš€
                        </li>`;
    } else {
        items.forEach((item, index) => {
            const li = document.createElement("li");
            // Estilo de fila
            li.className = "flex-between";
            li.style.padding = "15px 0";
            li.style.borderBottom = "1px solid var(--color-border)";
            
            li.innerHTML = `
                <div>
                    <span style="display:block; font-weight:bold;">${item.nombre}</span>
                    <small style="color:var(--color-accent)">${item.tipo === 'producto' ? 'Producto' : 'Spin Reward'}</small>
                </div>
                <div class="flex" style="align-items:center; gap:15px;">
                    <span>$${item.precio}</span>
                </div>
            `;

            if (item.tipo === "producto" && item.origen === "catalogo") {
                const btn = document.createElement("button");
                btn.innerHTML = "âœ•"; // Un icono simple de cerrar
                btn.className = "secondary";
                btn.style.padding = "5px 10px";
                btn.style.fontSize = "12px";
                btn.onclick = () => eliminarProducto(index, item.id);
                li.querySelector('.flex').appendChild(btn);
            }

            ul.appendChild(li);
        });
    }

    document.getElementById("total").innerText = getTotal().toLocaleString();
    }

    /**************************************************
    * ACCIONES
    **************************************************/

    function eliminarProducto(index, productoId) {
    eliminarItem(index);
    restaurarStock([productoId]);
    log("Producto eliminado del carrito");
    renderCarrito();
    }

    function cancelarCompra() {
    cancelarCompraCompleta();
    log("âŒ Compra cancelada y stock restaurado");
    renderCarrito();
    }

    function enviarPedidoWA() {
    if (getItemsCarrito().length === 0) {
        alert("El carrito estÃ¡ vacÃ­o");
        return;
    }

    enviarPedidoWhatsApp("573207096148");
    }


    /**************************************************
    * INIT
    **************************************************/

    document.addEventListener("DOMContentLoaded", async () => {
    await cargarInventario();
    inicializarCarrito();
    renderCarrito();
    });
    </script>

    </body>
</html>
