<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8">
    <title>Carrito | ShopUniverses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="./assets/css/styles.css">
    <link rel="stylesheet" href="./assets/css/theme.css">
    </head>

    <body>

    <nav>
    <a href="./index.html">Inicio</a>
    <a href="./catalogo.html">CatÃ¡logo</a>
    <a href="./spin.html">Spin</a>
    <a href="./carrito.html">Carrito</a>
    </nav>

    <main class="carrito-container">

    <h1>ðŸ›’ Carrito de Compras</h1>
    <p>Revisa tu pedido antes de enviarlo por WhatsApp.</p>

    <hr>

    <h3>Productos en el carrito</h3>
    <ul id="lista-carrito" class="carrito-lista"></ul>

    <div class="carrito-total">
        <strong>Total:</strong>
        <span>$<span id="total">0</span></span>
    </div>

    <div class="carrito-actions">
        <button class="btn-whatsapp" onclick="enviarPedidoWA()">Enviar pedido por WhatsApp</button>
        <button class="btn-cancelar" onclick="cancelarCompra()">Cancelar compra</button>
    </div>

    <hr>

    <h3>Log</h3>
    <div id="log"></div>

    </main>

    <!-- SCRIPTS -->
    <script src="./assets/js/data.js"></script>
    <script src="./assets/js/carrito.js"></script>
    <script src="./assets/js/main.js"></script>

    <script>
    /**************************************************
    * UTILIDADES
    **************************************************/
    function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
    }

    /**************************************************
    * RENDER
    **************************************************/
    function renderCarrito() {
    const ul = document.getElementById("lista-carrito");
    const items = getItemsCarrito();

    ul.innerHTML = "";

    if (items.length === 0) {
        ul.innerHTML = "<li>El carrito estÃ¡ vacÃ­o.</li>";
    } else {
        items.forEach((item, index) => {
        const li = document.createElement("li");
        li.classList.add("carrito-item");

        if (item.origen === "spin") {
            li.classList.add("spin", "gratis");
        }

        li.innerHTML = `
            <div class="carrito-item-info">
            <span class="carrito-item-nombre">${item.nombre}</span>
            ${item.origen === "spin" ? `<span class="badge">Spin</span>` : ""}
            </div>
            <span class="carrito-item-precio">$${item.precio}</span>
        `;

        if (item.tipo === "producto" && item.origen === "catalogo") {
            const btn = document.createElement("button");
            btn.textContent = "Quitar";
            btn.onclick = () => eliminarProducto(index, item.id);
            li.appendChild(btn);
        }

        ul.appendChild(li);
        });
    }

    document.getElementById("total").innerText = getTotal();
    }

    /**************************************************
    * ACCIONES
    **************************************************/
    function eliminarProducto(index, productoId) {
    eliminarItem(index);
    restaurarStock([productoId]);
    log("Producto eliminado del carrito");
    renderCarrito();
    }

    function cancelarCompra() {
    cancelarCompraCompleta();
    log("âŒ Compra cancelada y stock restaurado");
    renderCarrito();
    }

    function enviarPedidoWA() {
    const items = getItemsCarrito();
    if (items.length === 0) {
        alert("El carrito estÃ¡ vacÃ­o");
        return;
    }
    enviarPedidoWhatsApp("573207096148");
    }

    /**************************************************
    * INIT
    **************************************************/
    document.addEventListener("DOMContentLoaded", () => {
    renderCarrito();
    });
    </script>

    </body>
</html>
