<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8">
    <title>Spin | ShopUniverses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS mÃ­nimo temporal -->
    <style>
        body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: auto;
        }
        nav {
        margin-bottom: 20px;
        }
        nav a {
        margin-right: 10px;
        text-decoration: none;
        }
        button {
        padding: 10px 16px;
        margin: 5px 5px 5px 0;
        cursor: pointer;
        }
        button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        }
        .box {
        border: 1px solid #ccc;
        padding: 12px;
        margin-top: 15px;
        }
        .log {
        background: #f7f7f7;
        padding: 10px;
        min-height: 80px;
        font-size: 14px;
        }
    </style>
    </head>

    <body>

    <!-- NAVEGACIÃ“N -->
    <nav>
    <a href="./index.html">Inicio</a>
    <a href="./catalogo.html">CatÃ¡logo</a>
    <a href="./carrito.html">Carrito</a>
    </nav>

    <h1>ðŸŽ¡ Spin ShopUniverses</h1>
    <p>
    Por <strong>$25.000 COP</strong> obtÃ©n <strong>5 productos sorpresa</strong>.
    </p>

    <!-- CONTROLES -->
    <div class="box">
    <button id="btnIniciar" onclick="iniciarCompra()">Iniciar Spin</button>
    <button id="btnGirar" onclick="girarSpin()">Girar</button>
    <button id="btnPremium" onclick="aceptarPremiumSpin()">Aceptar Premium (+$8.000)</button>
    <button id="btnCancelar" onclick="cancelarTodo()">Cancelar Compra</button>
    </div>

    <!-- ESTADO -->
    <div class="box">
    <h3>Estado del Spin</h3>
    <p>
        <strong>Giros restantes:</strong>
        <span id="giros">-</span>
    </p>
    </div>

    <!-- PRODUCTOS GANADOS -->
    <div class="box">
    <h3>Productos ganados</h3>
    <ul id="productos"></ul>
    </div>

    <!-- CARRITO -->
    <div class="box">
    <h3>Carrito</h3>
    <ul id="carrito"></ul>
    <p>
        <strong>Total:</strong> $
        <span id="total">0</span>
    </p>
    </div>

    <!-- WHATSAPP -->
    <div class="box">
    <button onclick="enviarPedidoWA()">Enviar pedido por WhatsApp</button>
    </div>

    <!-- LOG -->
    <div class="box">
    <h3>Log</h3>
    <div id="log" class="log"></div>
    </div>

    <!-- SCRIPTS -->
    <script src="./assets/js/data.js"></script>
    <script src="./assets/js/spin.js"></script>
    <script src="./assets/js/carrito.js"></script>
    <script src="./assets/js/main.js"></script>

    <script>
    /**************************************************
    * UTILIDADES UI
    **************************************************/

    function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
    }

    function refrescarUI() {
    const spin = getSpinState();
    const items = getItemsCarrito();

    document.getElementById("giros").innerText =
        spin ? spin.girosRestantes : "-";

    // Productos ganados
    const ulProductos = document.getElementById("productos");
    ulProductos.innerHTML = "";
    if (spin) {
        spin.productosGanados.forEach(p => {
        const li = document.createElement("li");
        li.textContent = p.nombre + (p.premium ? " (Premium)" : "");
        ulProductos.appendChild(li);
        });
    }

    // Carrito
    const ulCarrito = document.getElementById("carrito");
    ulCarrito.innerHTML = "";
    items.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.nombre} â€” $${item.precio}`;
        ulCarrito.appendChild(li);
    });

    document.getElementById("total").innerText = getTotal();

    actualizarBotones();
    }

    function actualizarBotones() {
    const spin = getSpinState();

    const btnIniciar = document.getElementById("btnIniciar");
    const btnGirar = document.getElementById("btnGirar");
    const btnPremium = document.getElementById("btnPremium");

    if (!spin || !spin.activo) {
        btnIniciar.disabled = false;
        btnGirar.disabled = true;
        btnPremium.disabled = true;
        return;
    }

    btnIniciar.disabled = true;
    btnGirar.disabled = spin.girosRestantes <= 0;
    btnPremium.disabled =
        spin.girosRestantes > 0 || spin.premiumAceptado;
    }

    /**************************************************
    * ACCIONES
    **************************************************/

    function iniciarCompra() {
    const spin = getSpinState();

    if (spin && spin.activo) {
        log("âš ï¸ Ya tienes un Spin activo");
        refrescarUI();
        return;
    }

    iniciarCompraSpin();
    log("ðŸŽ¡ Spin iniciado");
    refrescarUI();
    }

    function girarSpin() {
    const ganador = girar();
    if (ganador) {
        log("ðŸŽ Ganaste: " + ganador.nombre);
    }
    refrescarUI();
    }

    function aceptarPremiumSpin() {
    const ganador = aceptarPremium();
    if (ganador) {
        log("ðŸ’Ž Premium ganado: " + ganador.nombre);
    }
    refrescarUI();
    }

    function cancelarTodo() {
    cancelarCompraCompleta();
    log("âŒ Compra cancelada y stock restaurado");
    refrescarUI();
    }

    function enviarPedidoWA() {
    enviarPedido("573207096148"); // tu nÃºmero
    }

    /**************************************************
    * REHIDRATACIÃ“N AUTOMÃTICA
    **************************************************/

    document.addEventListener("DOMContentLoaded", () => {
    const spin = getSpinState();
    if (spin && spin.activo) {
        log("ðŸ”„ Spin activo restaurado");
    }
    refrescarUI();
    });
    </script>

    </body>
</html>
